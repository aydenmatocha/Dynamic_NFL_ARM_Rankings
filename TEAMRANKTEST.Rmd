---
title: "R Notebook"
output: html_notebook
---

# Load Packages
```{r}
library(rvest)
library(dplyr)
library(nflfastR)
```

# Load Play-By-Play Data
```{r}
pbp <- load_pbp(2025)
```


# Get Win% and PD Data
## Get Team Abbreviations
```{r}
team_abbr <- c(
  "Arizona Cardinals" = "ARI",
  "Atlanta Falcons"  = "ATL",
  "Baltimore Ravens" = "BAL",
  "Buffalo Bills"    = "BUF",
  "Carolina Panthers"= "CAR",
  "Chicago Bears"    = "CHI",
  "Cincinnati Bengals" = "CIN",
  "Cleveland Browns" = "CLE",
  "Dallas Cowboys"   = "DAL",
  "Denver Broncos"   = "DEN",
  "Detroit Lions"    = "DET",
  "Green Bay Packers"= "GB",
  "Houston Texans"   = "HOU",
  "Indianapolis Colts" = "IND",
  "Jacksonville Jaguars" = "JAX",
  "Kansas City Chiefs" = "KC",
  "Las Vegas Raiders" = "LV",
  "Los Angeles Chargers" = "LAC",
  "Los Angeles Rams" = "LAR",
  "Miami Dolphins"   = "MIA",
  "Minnesota Vikings"= "MIN",
  "New England Patriots" = "NE",
  "New Orleans Saints" = "NO",
  "New York Giants"  = "NYG",
  "New York Jets"    = "NYJ",
  "Philadelphia Eagles" = "PHI",
  "Pittsburgh Steelers" = "PIT",
  "San Francisco 49ers" = "SF",
  "Seattle Seahawks" = "SEA",
  "Tampa Bay Buccaneers" = "TB",
  "Tennessee Titans" = "TEN",
  "Washington Commanders" = "WAS"
)
```

## Scrape Webpage
```{r}
url <- "https://www.profootballnetwork.com/nfl/standings/league/2025"

page <- read_html(url)

# grab *all* tables on the page
tables <- page %>% html_nodes("table") %>% html_table(fill = TRUE)

tables

# Take the first (main) standings table
standings <- tables[[1]]

# Promote first row to headers
colnames(standings) <- standings[1, ]

# Drop the first row (now redundant)
standings <- standings[-1, ]

colnames(standings)[1] <- "team"

standings <- standings %>%
  mutate(pct = as.numeric(PCT), pf = as.numeric(PF), pa = as.numeric(PA)) %>%
  select(team, pct, pf, pa) %>%
  mutate(diff = pf-pa) %>%
  mutate(team = team_abbr[team])

standings
```







# Get EPA Data
## Get Offensive Mean EPA
```{r}

```

## Get Defensive Mean EPA
```{r}

```

## Function For Teams



# Get initial Ranking


# Get SOS
## Get Opponents
```{r}
get_opponents <- function(team_input) {
  first_plays <- pbp %>%
  filter(posteam == team_input) %>%
  group_by(game_id) %>%
  slice_min(., order_by = play_id) %>% # Take only first play
  ungroup() %>%
  select(defteam)
return(first_plays)
}

get_opponents("LAC")
```

